#!/usr/bin/env php
<?php

namespace BHayes\CLI;

//to allow this to run any class by name as a global command, first check for a localized autoloader.
if (file_exists('vendor/autoload.php')) {
    include_once 'vendor/autoload.php';
}
//manually include the this version of CLI files in case it is also installed as a project package.
require_once __DIR__ . '/../php/UserResponse.php';
foreach (glob(__DIR__ . '/../php/CLI.php') as $file) {
    require_once $file;
}

if (php_sapi_name() != 'cli') {
    throw new \Error("This is a command line tool only.");
}


//first setup fallback so it grabs full arguments as it is now.
$CLI = new CLI();

//Then attempt to load argument one as a class to run.
$argumentOne = $argv[1] ?? null;
try {
    //remove the first argument
    unset($argv[1]);
    //reset the arrays so the missing argument doesnt break things.
    global $argv;
    global $argc;
    $argv = array_values($argv);
    $argc -= 1;
    //then attempt to load the class.
    $CLI = CLI::load($argumentOne);
} catch (\Throwable $e) {
    //no go, fallback is used.
}

$CLI->run();
